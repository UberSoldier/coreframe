<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.czf.sys.dao.MenuDao">

    <resultMap id="menuMap" type="com.czf.sys.entity.MenuEntity">
        <result property="id" column="id"/>
        <result property="parentId" column="parent_id"/>
        <result property="parentIds" column="parent_ids"/>
        <result property="name" column="name"/>
        <result property="url" column="url"/>
        <result property="icon" column="icon"/>
        <result property="sort" column="sort"/>
        <result property="status" column="status"/>
        <result property="permission" column="permission"/>
        <result property="remark" column="remark"/>
        <result property="createTime" column="create_time"/>
        <result property="createId" column="create_id"/>
        <result property="updateId" column="update_id"/>
        <result property="updateTime" column="update_time"/>
        <result property="type" column="type"/>
        <result property="open" column="open"/>
    </resultMap>

    <sql id="Base_Column_List">
        id,
        parent_id,
        parent_ids,
        name,
        url,
        open,
        icon,
        sort,
        status,
        permission,
        remark,
        create_time,
        create_id,
        update_id,
        update_time,
        type
    </sql>

    <!--根据登陆用户Id,查询出所有授权菜单-->
    <select id="queryByUserId" resultType="com.czf.sys.entity.MenuEntity" resultMap="menuMap">
        SELECT DISTINCT m.*,
        (SELECT tm.name FROM sys_menu tm WHERE tm.id=m.parent_id ) AS parentName
        FROM sys_user_role ur LEFT JOIN
        sys_role r ON ur.role_id=r.id LEFT JOIN
        sys_role_menu rm ON r.id=role_id LEFT JOIN
        sys_menu m ON m.id=rm.menu_id
        WHERE ur.user_id= #{userId} AND r.status='0' ORDER BY sort;
    </select>

    <select id="queryList" resultType="com.czf.sys.entity.MenuEntity" resultMap="menuMap">
        SELECT
        <include refid="Base_Column_List"/>,
        (SELECT tm.name FROM sys_menu tm WHERE tm.id=m.parent_id) AS parentName
        FROM sys_menu m ORDER BY sort
    </select>

    <!--根据父菜单Id查询菜单-->
    <select id="queryListParentId" resultType="com.czf.sys.entity.MenuEntity" resultMap="menuMap">
        select
        <include refid="Base_Column_List" />,
        (SELECT tm.name FROM sys_menu tm WHERE tm.id=m.parent_id ) AS parentName
        from sys_menu m
        where parent_id = #{parentId} ORDER BY sort
    </select>

</mapper>